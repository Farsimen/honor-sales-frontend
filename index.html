<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´ Honor</title>
<link href="https://cdn.jsdelivr.net/npm/vazirmatn@33.0.3/Vazirmatn-font-face.css" rel="stylesheet" />
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<style>
  * {
    box-sizing: border-box;
  }
  
  body {
    margin: 0;
    padding: 20px;
    font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Arial, sans-serif;
    background: #0a0a0a;
    color: white;
    min-height: 100vh;
    line-height: 1.6;
    position: relative;
    overflow-x: hidden;
  }

  /* Enhanced Star Field Background */
  .star-field {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: -10;
    background: radial-gradient(ellipse at center, #1a1a2e 0%, #16213e 70%, #0f0f23 100%);
    overflow: hidden;
  }

  /* Animated Canvas Background */
  #starCanvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -5;
  }

  /* QR Scanner Modal */
  .scanner-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.95);
    backdrop-filter: blur(15px);
    z-index: 3000;
    align-items: center;
    justify-content: center;
  }

  .scanner-container {
    background: rgba(0,0,0,0.9);
    border: 2px solid rgba(255,255,255,0.2);
    border-radius: 20px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    text-align: center;
    box-shadow: 0 25px 50px rgba(0,0,0,0.5), 0 0 30px rgba(57,149,231,0.3);
  }

  .scanner-header {
    margin-bottom: 20px;
  }

  .scanner-header h3 {
    margin: 0 0 10px 0;
    color: #3995e7;
    font-size: 24px;
  }

  .scanner-header p {
    margin: 0;
    color: rgba(255,255,255,0.8);
    font-size: 14px;
  }

  .scanner-help {
    background: rgba(255,193,7,0.1);
    border: 1px solid rgba(255,193,7,0.3);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 15px;
    font-size: 13px;
    color: #ffc107;
  }

  #qr-reader {
    border-radius: 15px;
    overflow: hidden;
    margin: 20px 0;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
  }

  .scanner-controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .scanner-btn {
    padding: 10px 16px;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: inherit;
    font-size: 13px;
  }

  .scanner-btn.primary {
    background: linear-gradient(45deg, #3995e7, #57c4e7);
    color: white;
    box-shadow: 0 4px 15px rgba(57,149,231,0.3);
  }

  .scanner-btn.secondary {
    background: rgba(255,255,255,0.2);
    color: white;
    box-shadow: 0 4px 15px rgba(255,255,255,0.1);
  }

  .scanner-btn.warning {
    background: linear-gradient(45deg, #ffc107, #ffb300);
    color: #000;
    box-shadow: 0 4px 15px rgba(255,193,7,0.3);
  }

  .scanner-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  }
  
  .container {
    max-width: 500px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
  }
  
  /* Header Styles */
  .header {
    text-align: center;
    margin: 60px 0 40px 0;
  }
  
  .logo {
    width: 80px;
    height: 80px;
    background: linear-gradient(45deg, #3ab54a, #3995e7);
    border-radius: 20px;
    margin: 0 auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    font-weight: bold;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5), 0 0 50px rgba(57,149,231,0.4);
    animation: logoFloat 3s ease-in-out infinite;
    color: white;
    border: 2px solid rgba(255,255,255,0.1);
    position: relative;
  }
  
  .logo::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #3ab54a, #3995e7, #3ab54a);
    border-radius: 20px;
    z-index: -1;
    animation: logoGlow 2s ease-in-out infinite alternate;
  }
  
  @keyframes logoFloat {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    33% { transform: translateY(-10px) rotate(2deg); }
    66% { transform: translateY(5px) rotate(-1deg); }
  }
  
  @keyframes logoGlow {
    0% { opacity: 0.5; }
    100% { opacity: 1; }
  }
  
  h1 {
    font-size: 28px;
    margin: 0;
    font-weight: 500;
    text-shadow: 0 2px 10px rgba(0,0,0,0.8), 0 0 20px rgba(255,255,255,0.1);
    animation: textGlow 3s ease-in-out infinite;
  }
  
  @keyframes textGlow {
    0%, 100% { text-shadow: 0 2px 10px rgba(0,0,0,0.8), 0 0 20px rgba(255,255,255,0.1); }
    50% { text-shadow: 0 2px 10px rgba(0,0,0,0.8), 0 0 30px rgba(57,149,231,0.3); }
  }
  
  /* Admin Panel */
  .admin-icon {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 56px;
    height: 56px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    font-size: 24px;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3), 0 0 20px rgba(255,255,255,0.1);
  }
  
  .admin-icon:hover {
    transform: scale(1.1) rotate(360deg);
    background: rgba(255,255,255,0.2);
    box-shadow: 0 12px 35px rgba(0,0,0,0.4), 0 0 30px rgba(255,255,255,0.2);
  }
  
  .admin-logged {
    background: rgba(55, 196, 83, 0.8) !important;
    border-color: rgba(55, 196, 83, 0.6) !important;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3), 0 0 30px rgba(55,196,83,0.4) !important;
  }
  
  #adminMenu {
    display: none;
    position: fixed;
    top: 90px;
    right: 20px;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(25px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 16px;
    padding: 20px;
    z-index: 1000;
    width: 240px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.6), 0 0 20px rgba(255,255,255,0.1);
    animation: slideIn 0.3s ease;
  }
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  #adminMenu button {
    width: 100%;
    padding: 12px 16px;
    margin: 8px 0;
    border: none;
    border-radius: 12px;
    background: linear-gradient(45deg, #1f4068, #3a416f);
    color: white;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: inherit;
    border: 1px solid rgba(255,255,255,0.1);
  }
  
  #adminMenu button:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 10px 25px rgba(0,0,0,0.4), 0 0 20px rgba(57,149,231,0.3);
    background: linear-gradient(45deg, #2a5085, #4a5a8f);
  }
  
  /* Form Styles */
  .form-card {
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(25px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 24px;
    padding: 30px;
    box-shadow: 0 25px 50px rgba(0,0,0,0.4), 0 0 30px rgba(255,255,255,0.05);
    margin-bottom: 30px;
    animation: cardFloat 4s ease-in-out infinite;
  }
  
  @keyframes cardFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
  }
  
  .input-group {
    position: relative;
    margin: 24px 0;
  }
  
  .input-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: rgba(255,255,255,0.9);
    font-size: 14px;
  }
  
  input[type="text"], input[type="date"], select {
    width: 100%;
    padding: 16px 50px 16px 20px;
    font-size: 17px;
    border-radius: 14px;
    border: 2px solid rgba(255,255,255,0.2);
    background: rgba(255,255,255,0.95);
    color: #333;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    font-family: inherit;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  
  input[type="text"]:focus, input[type="date"]:focus, select:focus {
    outline: none;
    border-color: #3995e7;
    background: rgba(255,255,255,0.98);
    transform: translateY(-3px) scale(1.01);
    box-shadow: 0 15px 35px rgba(0,0,0,0.3), 0 0 25px rgba(57,149,231,0.4);
  }
  
  input[type="text"]::placeholder {
    color: #666;
  }
  
  /* Date Input Styles */
  .date-picker-container {
    position: relative;
  }
  
  .date-picker-input {
    cursor: pointer;
    padding: 16px 20px !important;
    background: rgba(255,255,255,0.95);
    border: 2px solid rgba(255,255,255,0.2);
    text-align: center;
    font-weight: 600;
  }
  
  .date-picker-input:hover {
    border-color: #3995e7;
    background: rgba(255,255,255,0.98);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2), 0 0 20px rgba(57,149,231,0.2);
  }
  
  .date-picker-calendar {
    position: absolute;
    top: 100%;
    right: 0;
    left: 0;
    background: rgba(0,0,0,0.95);
    backdrop-filter: blur(25px);
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 16px;
    padding: 20px;
    z-index: 1001;
    box-shadow: 0 25px 50px rgba(0,0,0,0.6), 0 0 30px rgba(255,255,255,0.1);
    display: none;
    margin-top: 8px;
    animation: calendarSlide 0.3s ease;
  }
  
  @keyframes calendarSlide {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .date-picker-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  
  .month-year-selector {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  
  .month-year-selector select {
    padding: 8px;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.3);
    font-family: inherit;
    font-size: 14px;
    width: auto;
    background: rgba(0,0,0,0.8);
    color: white;
  }
  
  .nav-button {
    background: linear-gradient(45deg, #3995e7, #57c4e7);
    border: none;
    border-radius: 8px;
    width: 32px;
    height: 32px;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    box-shadow: 0 4px 12px rgba(57,149,231,0.3);
    transition: all 0.3s ease;
  }
  
  .nav-button:hover {
    transform: translateY(-2px) scale(1.1);
    box-shadow: 0 8px 20px rgba(57,149,231,0.5);
    background: linear-gradient(45deg, #2a5085, #4a8cb8);
  }
  
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
  }
  
  .day-header {
    text-align: center;
    font-weight: 600;
    color: rgba(255,255,255,0.8);
    padding: 8px 4px;
    font-size: 14px;
  }
  
  .day-cell {
    text-align: center;
    padding: 8px 4px;
    cursor: pointer;
    border-radius: 6px;
    color: rgba(255,255,255,0.9);
    font-weight: 500;
    min-height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }
  
  .day-cell:hover {
    background: rgba(57,149,231,0.4);
    box-shadow: 0 4px 15px rgba(57,149,231,0.3);
    transform: scale(1.15);
  }
  
  .day-cell.today {
    background: rgba(57,149,231,0.5);
    font-weight: bold;
    box-shadow: 0 0 15px rgba(57,149,231,0.6);
    animation: todayPulse 2s ease-in-out infinite;
  }
  
  @keyframes todayPulse {
    0%, 100% { box-shadow: 0 0 15px rgba(57,149,231,0.6); }
    50% { box-shadow: 0 0 25px rgba(57,149,231,0.8); }
  }
  
  .day-cell.selected {
    background: linear-gradient(45deg, #3995e7, #57c4e7);
    color: white;
    font-weight: bold;
    box-shadow: 0 4px 20px rgba(57,149,231,0.6);
    transform: scale(1.1);
  }
  
  .day-cell.other-month {
    color: rgba(255,255,255,0.3);
  }
  
  .scan-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-10%);
    font-size: 20px;
    cursor: pointer;
    color: #1f4068;
    transition: all 0.3s ease;
    background: rgba(31,64,104,0.1);
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .scan-icon:hover {
    background: rgba(31,64,104,0.2);
    transform: translateY(-10%) scale(1.2) rotate(10deg);
    box-shadow: 0 4px 15px rgba(31,64,104,0.3);
  }
  
  button.submit-btn {
    width: 100%;
    padding: 18px;
    font-size: 20px;
    background: linear-gradient(135deg, #3ab54a 0%, #57e389 50%, #3995e7 100%);
    border: none;
    border-radius: 14px;
    color: white;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(58,181,74,0.4), 0 0 25px rgba(57,149,231,0.2);
    position: relative;
    overflow: hidden;
    font-family: inherit;
    border: 1px solid rgba(255,255,255,0.1);
  }
  
  button.submit-btn::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
    transform: rotate(45deg);
    transition: all 0.6s ease;
    opacity: 0;
  }
  
  button.submit-btn:hover::before {
    animation: buttonShine 0.6s ease;
  }
  
  @keyframes buttonShine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
    50% { opacity: 1; }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0; }
  }
  
  button.submit-btn:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 20px 40px rgba(58,181,74,0.6), 0 0 40px rgba(57,149,231,0.4);
    background: linear-gradient(135deg, #48c55a 0%, #68f399 50%, #4aa5f7 100%);
  }
  
  button.submit-btn:active {
    transform: translateY(-2px) scale(0.98);
  }
  
  button.submit-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
  }
  
  /* Loading Animation */
  .loading {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }
  
  .spinner {
    width: 24px;
    height: 24px;
    border: 3px solid rgba(255,255,255,0.3);
    border-top: 3px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  /* Data Table */
  #dataTable {
    display: none;
    margin-top: 30px;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(25px);
    border: 1px solid rgba(255,255,255,0.2);
    padding: 25px;
    border-radius: 20px;
    max-width: 1000px;
    overflow-x: auto;
    box-shadow: 0 25px 50px rgba(0,0,0,0.4), 0 0 30px rgba(255,255,255,0.1);
    animation: tableSlide 0.5s ease;
  }
  
  @keyframes tableSlide {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  #dataTable h2 {
    margin-top: 0;
    color: white;
    font-weight: 500;
    text-align: center;
    margin-bottom: 25px;
    text-shadow: 0 2px 10px rgba(0,0,0,0.5);
  }
  
  #dataTable table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  
  #dataTable th,
  #dataTable td {
    padding: 10px 8px;
    border: 1px solid rgba(255,255,255,0.2);
    text-align: center;
    transition: all 0.3s ease;
    font-size: 13px;
  }
  
  #dataTable th {
    background: rgba(0,0,0,0.8);
    font-weight: 600;
    color: white;
    position: sticky;
    top: 0;
    z-index: 10;
    box-shadow: 0 2px 10px rgba(0,0,0,0.4);
  }
  
  #dataTable td {
    background: rgba(0,0,0,0.6);
    color: rgba(255,255,255,0.9);
  }
  
  #dataTable table tr:nth-child(even) td {
    background: rgba(25,40,90,0.4);
  }
  
  #dataTable table tr:hover td {
    background: rgba(57,149,231,0.3);
    box-shadow: 0 2px 15px rgba(57,149,231,0.2);
    transform: scale(1.01);
  }
  
  /* Modal */
  #deleteModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.9);
    backdrop-filter: blur(20px);
    align-items: center;
    justify-content: center;
    z-index: 2000;
    animation: fadeIn 0.3s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  .modal-content {
    background: rgba(0,0,0,0.95);
    backdrop-filter: blur(25px);
    border: 1px solid rgba(255,255,255,0.2);
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    color: white;
    max-width: 400px;
    margin: 20px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.6), 0 0 40px rgba(255,255,255,0.1);
    animation: modalSlide 0.3s ease;
  }
  
  @keyframes modalSlide {
    from {
      opacity: 0;
      transform: translateY(30px) scale(0.9);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  .modal-content h3 {
    margin-top: 0;
    color: #ff6b6b;
    text-shadow: 0 2px 10px rgba(255,107,107,0.4);
  }
  
  .modal-buttons {
    display: flex;
    gap: 15px;
    margin-top: 25px;
    justify-content: center;
  }
  
  .modal-buttons button {
    padding: 12px 24px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    font-family: inherit;
  }
  
  .btn-danger {
    background: linear-gradient(45deg, #ff4757, #ff3838);
    color: white;
    box-shadow: 0 4px 15px rgba(255,71,87,0.4);
  }
  
  .btn-secondary {
    background: rgba(255,255,255,0.2);
    color: white;
    box-shadow: 0 4px 15px rgba(255,255,255,0.1);
  }
  
  .modal-buttons button:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 25px rgba(0,0,0,0.4);
  }
  
  /* Success/Error Messages */
  .toast {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 15px 25px;
    border-radius: 12px;
    color: white;
    font-weight: 600;
    z-index: 3000;
    box-shadow: 0 15px 35px rgba(0,0,0,0.5), 0 0 25px rgba(255,255,255,0.1);
    backdrop-filter: blur(20px);
    animation: toastSlide 0.3s ease;
    max-width: 90%;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.2);
  }
  
  @keyframes toastSlide {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(-30px) scale(0.9);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0) scale(1);
    }
  }
  
  .toast.success {
    background: linear-gradient(45deg, rgba(46,213,115,0.95), rgba(123,237,159,0.95));
    box-shadow: 0 15px 35px rgba(46,213,115,0.4), 0 0 25px rgba(123,237,159,0.3);
  }
  
  .toast.error {
    background: linear-gradient(45deg, rgba(255,71,87,0.95), rgba(255,107,122,0.95));
    box-shadow: 0 15px 35px rgba(255,71,87,0.4), 0 0 25px rgba(255,107,122,0.3);
  }
  
  .toast.fadeOut {
    animation: toastFadeOut 0.3s ease forwards;
  }
  
  @keyframes toastFadeOut {
    to {
      opacity: 0;
      transform: translateX(-50%) translateY(-30px) scale(0.9);
    }
  }
  
  /* Responsive */
  @media (max-width: 600px) {
    body {
      padding: 10px;
    }
    
    .container {
      max-width: 100%;
    }
    
    .form-card {
      padding: 20px;
      margin: 20px 0;
    }
    
    .admin-icon {
      width: 48px;
      height: 48px;
      font-size: 20px;
    }
    
    #adminMenu {
      width: 200px;
      right: 10px;
    }
    
    h1 {
      font-size: 24px;
    }
    
    .logo {
      width: 60px;
      height: 60px;
      font-size: 28px;
    }
    
    #dataTable {
      padding: 15px;
    }
    
    #dataTable th,
    #dataTable td {
      padding: 6px 4px;
      font-size: 11px;
    }
    
    .modal-content {
      padding: 25px;
      margin: 10px;
    }
    
    .modal-buttons {
      flex-direction: column;
      gap: 10px;
    }
    
    .modal-buttons button {
      width: 100%;
    }
    
    .date-picker-calendar {
      right: -20px;
      left: -20px;
    }

    .scanner-container {
      padding: 20px;
      margin: 10px;
    }
    
    .scanner-controls {
      flex-direction: column;
      gap: 8px;
    }
  }
  
  /* Input validation styles */
  input[type="text"].error, input[type="date"].error, .date-picker-input.error {
    border-color: #ff4757;
    background: rgba(255,71,87,0.1);
    box-shadow: 0 0 20px rgba(255,71,87,0.4);
    animation: errorShake 0.5s ease;
  }
  
  @keyframes errorShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
  }
  
  input[type="text"].success, input[type="date"].success, .date-picker-input.success {
    border-color: #2ed573;
    box-shadow: 0 0 20px rgba(46,213,115,0.4);
    animation: successGlow 0.5s ease;
  }
  
  @keyframes successGlow {
    0% { box-shadow: 0 0 20px rgba(46,213,115,0.4); }
    50% { box-shadow: 0 0 30px rgba(46,213,115,0.6); }
    100% { box-shadow: 0 0 20px rgba(46,213,115,0.4); }
  }
  
  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }

  /* Enhanced glow effects */
  .form-card:hover {
    box-shadow: 0 30px 60px rgba(0,0,0,0.5), 0 0 40px rgba(255,255,255,0.1);
    transform: translateY(-2px);
  }

  #dataTable:hover {
    box-shadow: 0 30px 60px rgba(0,0,0,0.5), 0 0 40px rgba(255,255,255,0.1);
  }
</style>
</head>
<body>

<div class="star-field" id="starField">
  <canvas id="starCanvas"></canvas>
</div>

<!-- QR Scanner Modal -->
<div class="scanner-modal" id="scannerModal">
  <div class="scanner-container">
    <div class="scanner-header">
      <h3>ğŸ“± Ø§Ø³Ú©Ù†Ø± Ø¨Ø§Ø±Ú©Ø¯ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h3>
      <p>Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø§ Ù†Ø²Ø¯ÛŒÚ© Ù„ÛŒØ¨Ù„ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯</p>
    </div>
    <div class="scanner-help">
      ğŸ’¡ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ù† Ø¨Ù‡ØªØ±: Ù†ÙˆØ± Ú©Ø§ÙÛŒØŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø«Ø§Ø¨ØªØŒ ÙØ§ØµÙ„Ù‡ 5-15 Ø³Ø§Ù†ØªÛŒ
    </div>
    <div id="qr-reader" style="width: 100%; max-width: 400px; margin: 0 auto;"></div>
    <div class="scanner-controls">
      <button class="scanner-btn secondary" onclick="stopScanner()">âŒ Ø¨Ø³ØªÙ†</button>
      <button class="scanner-btn primary" id="switchCamera" onclick="switchCamera()">ğŸ”„ Ø¯ÙˆØ±Ø¨ÛŒÙ†</button>
      <button class="scanner-btn warning" id="torchBtn" onclick="toggleTorch()" style="display: none;">ğŸ”¦ ÙÙ„Ø´</button>
    </div>
  </div>
</div>

<div class="admin-icon" id="adminIcon" title="Ù…Ø¯ÛŒØ±ÛŒØª">ğŸ‘¤</div>

<div id="adminMenu">
  <button onclick="loadSalesData()">
    <span>ğŸ“Š</span>
    <span>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª</span>
  </button>
  <button onclick="downloadData()">
    <span>ğŸ“¥</span>
    <span>Ø¯Ø§Ù†Ù„ÙˆØ¯ CSV</span>
  </button>
  <button onclick="showDeleteModal()">
    <span>ğŸ—‘ï¸</span>
    <span>Ø­Ø°Ù Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</span>
  </button>
  <button onclick="logoutAdmin()">
    <span>ğŸšª</span>
    <span>Ø®Ø±ÙˆØ¬</span>
  </button>
</div>

<div class="container">
  <div class="header">
    <div class="logo">H</div>
    <h1>Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±ÙˆØ´ Honor</h1>
  </div>

  <div class="form-card">
    <div class="input-group">
      <label class="input-label">Ù†Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡</label>
      <input type="text" id="storeNameInput" placeholder="Ù†Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
    </div>
    
    <div class="input-group">
      <label class="input-label">Ø³Ø±ÛŒØ§Ù„ IMEI</label>
      <input type="text" id="imeiInput" placeholder="Ø³Ø±ÛŒØ§Ù„ IMEI Ø±Ø§ ÙˆØ§Ø±Ø¯ ÛŒØ§ Ø§Ø³Ú©Ù† Ú©Ù†ÛŒØ¯" maxlength="15" />
      <span class="scan-icon" title="Ø§Ø³Ú©Ù† Ø¨Ø§Ø±Ú©Ø¯" onclick="startScanner()">ğŸ“·</span>
    </div>
    
    <div class="input-group">
      <label class="input-label">Ù…Ø¯Ù„ Ú¯ÙˆØ´ÛŒ</label>
      <input type="text" id="modelInput" placeholder="Ù…Ø«Ø§Ù„: Honor X5B" />
    </div>
    
    <div class="input-group">
      <label class="input-label">Ø´Ù‡Ø±</label>
      <input type="text" id="cityInput" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" />
    </div>
    
    <div class="input-group">
      <label class="input-label">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
      <input type="text" id="phoneInput" placeholder="09xxxxxxxxx" maxlength="11" />
    </div>
    
    <div class="input-group">
      <label class="input-label">ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª ÙØ±ÙˆØ´ (Ø´Ù…Ø³ÛŒ)</label>
      <div class="date-picker-container">
        <input type="text" id="dateInput" class="date-picker-input" placeholder="ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯" readonly />
        <div class="date-picker-calendar" id="datePickerCalendar">
          <div class="date-picker-header">
            <button type="button" class="nav-button" id="prevMonth">â€¹</button>
            <div class="month-year-selector">
              <select id="monthSelector"></select>
              <select id="yearSelector"></select>
            </div>
            <button type="button" class="nav-button" id="nextMonth">â€º</button>
          </div>
          <div class="calendar-grid" id="calendarGrid"></div>
        </div>
      </div>
    </div>
    
    <button class="submit-btn" onclick="submitSale()" id="submitBtn">
      <span id="submitText">Ø«Ø¨Øª ÙØ±ÙˆØ´</span>
      <div class="loading" id="loading">
        <div class="spinner"></div>
      </div>
    </button>
  </div>
</div>

<div id="dataTable">
  <h2>ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±ÙˆØ´</h2>
  <table>
    <thead>
      <tr>
        <th>Ø±Ø¯ÛŒÙ</th>
        <th>Ù†Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡</th>
        <th>IMEI</th>
        <th>Ù…Ø¯Ù„</th>
        <th>Ø´Ù‡Ø±</th>
        <th>ØªÙ…Ø§Ø³</th>
        <th>ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ</th>
      </tr>
    </thead>
    <tbody id="salesTbody"></tbody>
  </table>
</div>

<div id="deleteModal">
  <div class="modal-content">
    <h3>âš ï¸ Ù‡Ø´Ø¯Ø§Ø±</h3>
    <p>Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø­Ø°Ù Ø´ÙˆÙ†Ø¯ØŸ<br>
    Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø±Ú¯Ø´Øª Ù†ÛŒØ³Øª!</p>
    <div class="modal-buttons">
      <button class="btn-danger" onclick="deleteAllData()">Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ú©Ù†</button>
      <button class="btn-secondary" onclick="hideDeleteModal()">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>
  </div>
</div>

<script>
  const API_BASE = 'https://honor-sales-worker.farsimen.workers.dev';

  // Ø­Ø§Ù„Øª Ø§Ø¯Ù…ÛŒÙ†
  let isAdminLoggedIn = localStorage.getItem('adminToken') === 'Honor2025Admin!';

  // Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª Ù„Ø§Ú¯ÛŒÙ†
  const adminIcon = document.getElementById('adminIcon');
  const adminMenu = document.getElementById('adminMenu');

  // QR Scanner variables - Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ¨Ù„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©
  let html5QrcodeScanner = null;
  let currentCameraId = null;
  let cameras = [];
  let torchEnabled = false;

  // âœ… ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ù‡ Ø´Ù…Ø³ÛŒ (Ø¯Ù‚ÛŒÙ‚ Ùˆ ØµØ­ÛŒØ­)
  function gregorianToJalali(gy, gm, gd) {
    const g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
    let jy = (gy > 1600) ? 979 : 0;
    gy = (gy > 1600) ? gy - 1600 : gy - 621;
    if (gm > 2) gy++;
    
    let days = 365 * gy + Math.floor((gy + 3) / 4) - Math.floor((gy + 99) / 100) + Math.floor((gy + 399) / 400) - 80 + gd + g_d_m[gm - 1];
    jy += 33 * Math.floor(days / 12053);
    days %= 12053;
    jy += 4 * Math.floor(days / 1461);
    days %= 1461;
    if (days > 365) {
      jy += Math.floor((days - 1) / 365);
      days = (days - 1) % 365;
    }
    
    let jm, jd;
    if (days < 186) {
      jm = 1 + Math.floor(days / 31);
      jd = 1 + (days % 31);
    } else {
      jm = 7 + Math.floor((days - 186) / 30);
      jd = 1 + ((days - 186) % 30);
    }
    
    return { year: jy, month: jm, day: jd };
  }

  // âœ… ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÙ„Ø§Ø¯ÛŒ (Ø¯Ù‚ÛŒÙ‚ Ùˆ ØµØ­ÛŒØ­)
  function jalaliToGregorian(jy, jm, jd) {
    let gy = (jy > 979) ? 1600 : 621;
    jy = (jy > 979) ? jy - 979 : jy;
    
    let days = 365 * jy + Math.floor(jy / 33) * 8 + Math.floor(((jy % 33) + 3) / 4) + 78 + jd;
    if (jm < 7) days += (jm - 1) * 31;
    else days += (jm - 7) * 30 + 186;
    
    gy += 400 * Math.floor(days / 146097);
    days %= 146097;
    if (days > 36524) {
      days--;
      gy += 100 * Math.floor(days / 36524);
      days %= 36524;
      if (days >= 365) days++;
    }
    
    gy += 4 * Math.floor(days / 1461);
    days %= 1461;
    if (days > 365) {
      gy += Math.floor((days - 1) / 365);
      days = (days - 1) % 365;
    }
    
    let gd = days + 1;
    let sal_a = [0, 31, (gy % 4 === 0 && gy % 100 !== 0) || (gy % 400 === 0) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    let gm = 0;
    while (gm < 13 && gd > sal_a[gm]) {
      gd -= sal_a[gm];
      gm++;
    }
    
    return { year: gy, month: gm, day: gd };
  }

  // Ù†Ø§Ù… Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ
  const persianMonthNames = [
    'ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±',
    'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'
  ];

  // Ù†Ø§Ù… Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‡ÙØªÙ‡
  const persianDayNames = ['Ø´', 'ÛŒ', 'Ø¯', 'Ø³', 'Ú†', 'Ù¾', 'Ø¬'];

  // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ ØªÙ‚ÙˆÛŒÙ…
  let currentJalaliYear, currentJalaliMonth;
  let selectedDate = null;

  // âœ… ØªÙ†Ø¸ÛŒÙ… ØªÙ‚ÙˆÛŒÙ… Ø´Ù…Ø³ÛŒ
  function initializeDatePicker() {
    const dateInput = document.getElementById('dateInput');
    const calendar = document.getElementById('datePickerCalendar');
    const monthSelector = document.getElementById('monthSelector');
    const yearSelector = document.getElementById('yearSelector');
    const prevMonthBtn = document.getElementById('prevMonth');
    const nextMonthBtn = document.getElementById('nextMonth');

    // ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ Ø´Ù…Ø³ÛŒ
    const today = new Date();
    const todayJalali = gregorianToJalali(today.getFullYear(), today.getMonth() + 1, today.getDate());
    
    currentJalaliYear = todayJalali.year;
    currentJalaliMonth = todayJalali.month;
    selectedDate = todayJalali;

    // Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø´Ù…Ø³ÛŒ
    updateDateInput();

    // Ù¾Ø± Ú©Ø±Ø¯Ù† selector Ù…Ø§Ù‡â€ŒÙ‡Ø§
    persianMonthNames.forEach((month, index) => {
      const option = document.createElement('option');
      option.value = index + 1;
      option.textContent = month;
      monthSelector.appendChild(option);
    });

    // Ù¾Ø± Ú©Ø±Ø¯Ù† selector Ø³Ø§Ù„â€ŒÙ‡Ø§
    for (let year = currentJalaliYear - 10; year <= currentJalaliYear + 10; year++) {
      const option = document.createElement('option');
      option.value = year;
      option.textContent = year;
      yearSelector.appendChild(option);
    }

    monthSelector.value = currentJalaliMonth;
    yearSelector.value = currentJalaliYear;

    // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
    dateInput.addEventListener('click', () => {
      calendar.style.display = calendar.style.display === 'block' ? 'none' : 'block';
      updateCalendar();
    });

    document.addEventListener('click', (e) => {
      if (!calendar.contains(e.target) && !dateInput.contains(e.target)) {
        calendar.style.display = 'none';
      }
    });

    monthSelector.addEventListener('change', () => {
      currentJalaliMonth = parseInt(monthSelector.value);
      updateCalendar();
    });

    yearSelector.addEventListener('change', () => {
      currentJalaliYear = parseInt(yearSelector.value);
      updateCalendar();
    });

    prevMonthBtn.addEventListener('click', () => {
      if (currentJalaliMonth === 1) {
        currentJalaliMonth = 12;
        currentJalaliYear--;
      } else {
        currentJalaliMonth--;
      }
      monthSelector.value = currentJalaliMonth;
      yearSelector.value = currentJalaliYear;
      updateCalendar();
    });

    nextMonthBtn.addEventListener('click', () => {
      if (currentJalaliMonth === 12) {
        currentJalaliMonth = 1;
        currentJalaliYear++;
      } else {
        currentJalaliMonth++;
      }
      monthSelector.value = currentJalaliMonth;
      yearSelector.value = currentJalaliYear;
      updateCalendar();
    });
  }

  function updateDateInput() {
    const dateInput = document.getElementById('dateInput');
    if (selectedDate) {
      dateInput.value = `${selectedDate.day} ${persianMonthNames[selectedDate.month - 1]} ${selectedDate.year}`;
    }
  }

  function updateCalendar() {
    const calendarGrid = document.getElementById('calendarGrid');
    calendarGrid.innerHTML = '';

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† header Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‡ÙØªÙ‡
    persianDayNames.forEach(dayName => {
      const dayHeader = document.createElement('div');
      dayHeader.className = 'day-header';
      dayHeader.textContent = dayName;
      calendarGrid.appendChild(dayHeader);
    });

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ² Ø§ÙˆÙ„ Ù…Ø§Ù‡
    const firstDayOfMonth = jalaliToGregorian(currentJalaliYear, currentJalaliMonth, 1);
    const firstDay = new Date(firstDayOfMonth.year, firstDayOfMonth.month - 1, firstDayOfMonth.day);
    const firstDayWeekday = (firstDay.getDay() + 1) % 7; // Ø´Ù†Ø¨Ù‡ = 0

    // ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù‡
    const daysInMonth = currentJalaliMonth <= 6 ? 31 : (currentJalaliMonth <= 11 ? 30 : 
      (((currentJalaliYear % 33) * 8 + ((currentJalaliYear % 33) + 3) / 4) % 30 < 1) ? 30 : 29);

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø´Ø±ÙˆØ¹ Ù…Ø§Ù‡
    for (let i = 0; i < firstDayWeekday; i++) {
      const emptyCell = document.createElement('div');
      emptyCell.className = 'day-cell';
      calendarGrid.appendChild(emptyCell);
    }

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù‡
    const today = new Date();
    const todayJalali = gregorianToJalali(today.getFullYear(), today.getMonth() + 1, today.getDate());

    for (let day = 1; day <= daysInMonth; day++) {
      const dayCell = document.createElement('div');
      dayCell.className = 'day-cell';
      dayCell.textContent = day;

      // ØªØ´Ø®ÛŒØµ Ø±ÙˆØ² Ø§Ù…Ø±ÙˆØ²
      if (currentJalaliYear === todayJalali.year && 
          currentJalaliMonth === todayJalali.month && 
          day === todayJalali.day) {
        dayCell.classList.add('today');
      }

      // ØªØ´Ø®ÛŒØµ Ø±ÙˆØ² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
      if (selectedDate && 
          currentJalaliYear === selectedDate.year && 
          currentJalaliMonth === selectedDate.month && 
          day === selectedDate.day) {
        dayCell.classList.add('selected');
      }

      dayCell.addEventListener('click', () => {
        selectedDate = { year: currentJalaliYear, month: currentJalaliMonth, day: day };
        updateDateInput();
        document.getElementById('datePickerCalendar').style.display = 'none';
      });

      calendarGrid.appendChild(dayCell);
    }
  }

  // Enhanced Star Field Canvas Animation - Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
  function createStarFieldCanvas() {
    const canvas = document.getElementById('starCanvas');
    const ctx = canvas.getContext('2d');
    let animationId;
    const isMobile = window.innerWidth <= 768;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }

    resizeCanvas();
    window.addEventListener('resize', () => {
      resizeCanvas();
      createStars();
    });

    const stars = [];
    const numStars = isMobile ? 100 : 200;
    const speed = isMobile ? 1 : 1.5;

    function createStars() {
      stars.length = 0;
      for (let i = 0; i < numStars; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          z: Math.random() * 1000 + 1,
          prevX: 0,
          prevY: 0,
          opacity: Math.random() * 0.7 + 0.3,
          twinkle: Math.random() * 0.02 + 0.01,
          twinkleDirection: Math.random() > 0.5 ? 1 : -1
        });
      }
    }

    function animate() {
      ctx.fillStyle = 'rgba(10, 10, 10, 0.08)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;

      for (let star of stars) {
        star.z -= speed;

        if (star.z <= 0) {
          star.x = Math.random() * canvas.width;
          star.y = Math.random() * canvas.height;
          star.z = 1000;
        }

        const x = (star.x - centerX) * (1000 / star.z) + centerX;
        const y = (star.y - centerY) * (1000 / star.z) + centerY;

        const size = Math.max(0.5, (1000 - star.z) / 1000 * (isMobile ? 2 : 3));
        let opacity = (1000 - star.z) / 1000 * star.opacity;

        // Twinkle effect
        star.opacity += star.twinkle * star.twinkleDirection;
        if (star.opacity >= 1) star.twinkleDirection = -1;
        if (star.opacity <= 0.3) star.twinkleDirection = 1;

        if (x < -10 || x > canvas.width + 10 || y < -10 || y > canvas.height + 10) {
          continue;
        }

        // Draw star
        ctx.beginPath();
        ctx.fillStyle = `rgba(255, 255, 255, ${opacity})`;
        ctx.shadowColor = 'rgba(255, 255, 255, 0.6)';
        ctx.shadowBlur = size;
        ctx.arc(x, y, size, 0, Math.PI * 2);
        ctx.fill();

        star.prevX = x;
        star.prevY = y;
      }

      ctx.shadowBlur = 0;
      animationId = requestAnimationFrame(animate);
    }

    createStars();
    animate();

    return () => {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
    };
  }

  // âœ… QR Scanner Functions - Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ¨Ù„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø¨Ø§ Ø²ÙˆÙ… Ùˆ ÙÙ„Ø´
  async function startScanner() {
    try {
      document.getElementById('scannerModal').style.display = 'flex';
      
      cameras = await Html5Qrcode.getCameras();
      
      if (cameras && cameras.length) {
        // Ø§Ù†ØªØ®Ø§Ø¨ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¹Ù‚Ø¨ (Ø¨Ù‡ØªØ± Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ù†)
        const backCamera = cameras.find(camera => 
          camera.label && (camera.label.toLowerCase().includes('back') || 
                          camera.label.toLowerCase().includes('rear') ||
                          camera.label.toLowerCase().includes('environment'))
        ) || cameras[cameras.length - 1]; // Ø¢Ø®Ø±ÛŒÙ† Ø¯ÙˆØ±Ø¨ÛŒÙ† Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¹Ù‚Ø¨ Ø§Ø³Øª
        
        currentCameraId = backCamera.id;
        
        html5QrcodeScanner = new Html5Qrcode("qr-reader");
        
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡ÛŒÙ†Ù‡ Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ¨Ù„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© Ø¨Ø§ Ø²ÙˆÙ…
        const config = {
          fps: 20, // FPS Ø¨Ø§Ù„Ø§ØªØ± Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª Ø¨ÛŒØ´ØªØ±
          qrbox: function(viewfinderWidth, viewfinderHeight) {
            // Ø¬Ø¹Ø¨Ù‡ Ø§Ø³Ú©Ù† Ú©ÙˆÚ†Ú©â€ŒØªØ± Ùˆ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±
            const minEdge = Math.min(viewfinderWidth, viewfinderHeight);
            const qrboxSize = Math.floor(minEdge * 0.7);
            return {
              width: qrboxSize,
              height: Math.floor(qrboxSize * 0.6) // Ø¨Ø§Ø±ÛŒÚ©â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø±Ú©Ø¯
            };
          },
          aspectRatio: 1.0,
          disableFlip: false,
          // ÙØ±Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ø§Ø±Ú©Ø¯
          formatsToSupport: [
            Html5QrcodeSupportedFormats.QR_CODE,
            Html5QrcodeSupportedFormats.CODE_128,
            Html5QrcodeSupportedFormats.CODE_39,
            Html5QrcodeSupportedFormats.EAN_13,
            Html5QrcodeSupportedFormats.EAN_8,
            Html5QrcodeSupportedFormats.UPC_A,
            Html5QrcodeSupportedFormats.UPC_E,
            Html5QrcodeSupportedFormats.CODE_93
          ],
          // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§ Ùˆ Ø²ÙˆÙ…
          videoConstraints: {
            facingMode: "environment", // Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¹Ù‚Ø¨
            width: { ideal: 1920, max: 4096 },
            height: { ideal: 1080, max: 2160 },
            advanced: [
              { zoom: 1.5 }, // Ø²ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ¨Ù„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©
              { focusMode: "continuous" },
              { exposureMode: "continuous" },
              { whiteBalanceMode: "continuous" }
            ]
          },
          // Ø­Ø³Ø§Ø³ÛŒØª Ø¨Ø§Ù„Ø§ Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ¨Ù„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú©
          experimentalFeatures: {
            useBarCodeDetectorIfSupported: true
          }
        };

        await html5QrcodeScanner.start(
          { facingMode: "environment" }, // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¹Ù‚Ø¨
          config,
          (decodedText, decodedResult) => {
            console.log('Ú©Ø¯ Ø§Ø³Ú©Ù† Ø´Ø¯:', decodedText);
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ¶Ø§Ù‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ùˆ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ ØºÛŒØ±Ø¶Ø±ÙˆØ±ÛŒ
            const cleanedText = decodedText.trim().replace(/[^\d]/g, '');
            document.getElementById('imeiInput').value = cleanedText;
            validateField(document.getElementById('imeiInput'), cleanedText.length === 15);
            stopScanner();
            showToast('Ú©Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø³Ú©Ù† Ø´Ø¯! âœ…', 'success');
          },
          (errorMessage) => {
            // Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù¾ÛŒÙˆØ³ØªÙ‡ Ø§Ø³Ú©Ù† Ø±Ø§ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…
          }
        );

        // Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„
        document.getElementById('switchCamera').style.display = cameras.length > 1 ? 'inline-block' : 'none';
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙÙ„Ø´
        try {
          const track = html5QrcodeScanner.getRunningTrackCameraCapabilities();
          if (track && track.torch) {
            document.getElementById('torchBtn').style.display = 'inline-block';
          }
        } catch (e) {
          // ÙÙ„Ø´ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
          console.log('Torch not supported:', e);
        }

      } else {
        showToast('Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª! âŒ', 'error');
        stopScanner();
      }
    } catch (err) {
      console.error('Error starting scanner:', err);
      showToast('Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†: ' + err.message, 'error');
      stopScanner();
    }
  }

  async function stopScanner() {
    try {
      if (html5QrcodeScanner) {
        await html5QrcodeScanner.stop();
        html5QrcodeScanner.clear();
        html5QrcodeScanner = null;
        torchEnabled = false;
      }
    } catch (err) {
      console.error('Error stopping scanner:', err);
    }
    document.getElementById('scannerModal').style.display = 'none';
    document.getElementById('torchBtn').style.display = 'none';
  }

  async function switchCamera() {
    if (cameras.length <= 1) return;
    
    try {
      if (html5QrcodeScanner) {
        await html5QrcodeScanner.stop();
        html5QrcodeScanner.clear();
      }
      
      const currentIndex = cameras.findIndex(camera => camera.id === currentCameraId);
      const nextIndex = (currentIndex + 1) % cameras.length;
      currentCameraId = cameras[nextIndex].id;
      
      const config = {
        fps: 20,
        qrbox: function(viewfinderWidth, viewfinderHeight) {
          const minEdge = Math.min(viewfinderWidth, viewfinderHeight);
          const qrboxSize = Math.floor(minEdge * 0.7);
          return { width: qrboxSize, height: Math.floor(qrboxSize * 0.6) };
        },
        aspectRatio: 1.0,
        disableFlip: false,
        formatsToSupport: [
          Html5QrcodeSupportedFormats.QR_CODE,
          Html5QrcodeSupportedFormats.CODE_128,
          Html5QrcodeSupportedFormats.CODE_39,
          Html5QrcodeSupportedFormats.EAN_13,
          Html5QrcodeSupportedFormats.EAN_8,
          Html5QrcodeSupportedFormats.UPC_A,
          Html5QrcodeSupportedFormats.UPC_E
        ],
        videoConstraints: {
          advanced: [{ zoom: 1.5 }]
        }
      };

      html5QrcodeScanner = new Html5Qrcode("qr-reader");
      await html5QrcodeScanner.start(
        currentCameraId,
        config,
        (decodedText, decodedResult) => {
          const cleanedText = decodedText.trim().replace(/[^\d]/g, '');
          document.getElementById('imeiInput').value = cleanedText;
          validateField(document.getElementById('imeiInput'), cleanedText.length === 15);
          stopScanner();
          showToast('Ú©Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø³Ú©Ù† Ø´Ø¯! âœ…', 'success');
        },
        (errorMessage) => {}
      );
      
      showToast('Ø¯ÙˆØ±Ø¨ÛŒÙ† ØªØºÛŒÛŒØ± ÛŒØ§ÙØª ğŸ“·', 'success');
    } catch (err) {
      console.error('Error switching camera:', err);
      showToast('Ø®Ø·Ø§ Ø¯Ø± ØªØºÛŒÛŒØ± Ø¯ÙˆØ±Ø¨ÛŒÙ†: ' + err.message, 'error');
    }
  }

  // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ÙÙ„Ø´
  async function toggleTorch() {
    try {
      if (html5QrcodeScanner) {
        const track = html5QrcodeScanner.getRunningTrackCameraCapabilities();
        if (track && track.torch) {
          await html5QrcodeScanner.applyVideoConstraints({
            advanced: [{ torch: !torchEnabled }]
          });
          torchEnabled = !torchEnabled;
          document.getElementById('torchBtn').textContent = torchEnabled ? 'ğŸ”¦ Ø®Ø§Ù…ÙˆØ´' : 'ğŸ”¦ ÙÙ„Ø´';
          showToast(torchEnabled ? 'ÙÙ„Ø´ Ø±ÙˆØ´Ù† Ø´Ø¯ ğŸ”¦' : 'ÙÙ„Ø´ Ø®Ø§Ù…ÙˆØ´ Ø´Ø¯', 'success');
        }
      }
    } catch (err) {
      console.error('Torch error:', err);
      showToast('ÙÙ„Ø´ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯', 'error');
    }
  }

  function toggleAdminMenu() {
    if (adminMenu.style.display === 'block') {
      adminMenu.style.display = 'none';
    } else {
      adminMenu.style.display = isAdminLoggedIn ? 'block' : 'none';
    }
    if(!isAdminLoggedIn) document.getElementById('dataTable').style.display = 'none';
  }

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù‡Ù†Ú¯Ø§Ù… load
  window.onload = () => {
    if (isAdminLoggedIn) {
      adminIcon.classList.add('admin-logged');
    }
    initializeDatePicker();
    createStarFieldCanvas();
  };

  // Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ø¢Ù†
  document.addEventListener('click', (e) => {
    if (!adminIcon.contains(e.target) && !adminMenu.contains(e.target)) {
      adminMenu.style.display = 'none';
    }
  });

  // ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†
  adminIcon.onclick = (e) => {
    e.stopPropagation();
    if (isAdminLoggedIn) {
      toggleAdminMenu();
      return;
    }
    const pass = prompt('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:');
    if (pass === 'Honor2025Admin!') {
      localStorage.setItem('adminToken', 'Honor2025Admin!');
      isAdminLoggedIn = true;
      adminIcon.classList.add('admin-logged');
      toggleAdminMenu();
      showToast('ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²! ğŸ‰', 'success');
    } else if (pass !== null) {
      showToast('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª! âŒ', 'error');
    }
  };

  function logoutAdmin(){
    localStorage.removeItem('adminToken');
    isAdminLoggedIn = false;
    adminIcon.classList.remove('admin-logged');
    adminMenu.style.display = 'none';
    document.getElementById('dataTable').style.display = 'none';
    showToast('Ø®Ø±ÙˆØ¬ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ ğŸ‘‹', 'success');
  }

  // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… toast
  function showToast(text, type = 'success') {
    const existingToast = document.querySelector('.toast');
    if (existingToast) {
      existingToast.remove();
    }
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = text;
    document.body.appendChild(toast);
    
    setTimeout(() => {
      toast.classList.add('fadeOut');
      setTimeout(() => {
        toast.remove();
      }, 300);
    }, 4000);
  }

  // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§
  function validateField(input, isValid) {
    input.classList.remove('error', 'success');
    if (isValid) {
      input.classList.add('success');
    } else {
      input.classList.add('error');
    }
  }

  // âœ… Ø«Ø¨Øª ÙØ±ÙˆØ´ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
  async function submitSale() {
    const storeName = document.getElementById('storeNameInput').value.trim();
    const imei = document.getElementById('imeiInput').value.trim();
    const model = document.getElementById('modelInput').value.trim();
    const city = document.getElementById('cityInput').value.trim();
    const phone = document.getElementById('phoneInput').value.trim();

    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
    const storeNameInput = document.getElementById('storeNameInput');
    const imeiInput = document.getElementById('imeiInput');
    const modelInput = document.getElementById('modelInput');
    const dateInput = document.getElementById('dateInput');

    if (!storeName) {
      validateField(storeNameInput, false);
      showToast('Ù†Ø§Ù… ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. âš ï¸', 'error');
      storeNameInput.focus();
      return;
    }
    validateField(storeNameInput, true);

    if (!imei || imei.length !== 15) {
      validateField(imeiInput, false);
      showToast('IMEI Ø¨Ø§ÛŒØ¯ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ 15 Ø±Ù‚Ù… Ø¨Ø§Ø´Ø¯. âš ï¸', 'error');
      imeiInput.focus();
      return;
    }
    validateField(imeiInput, true);

    if (!model) {
      validateField(modelInput, false);
      showToast('Ù…Ø¯Ù„ Ú¯ÙˆØ´ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. âš ï¸', 'error');
      modelInput.focus();
      return;
    }
    validateField(modelInput, true);

    if (!selectedDate) {
      validateField(dateInput, false);
      showToast('ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª ÙØ±ÙˆØ´ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. ğŸ“…', 'error');
      dateInput.focus();
      return;
    }
    validateField(dateInput, true);

    // âœ… ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„
    const gregorianDate = jalaliToGregorian(selectedDate.year, selectedDate.month, selectedDate.day);
    const saleDate = `${gregorianDate.year}-${gregorianDate.month.toString().padStart(2, '0')}-${gregorianDate.day.toString().padStart(2, '0')}`;

    // Ù†Ù…Ø§ÛŒØ´ Ù„ÙˆØ¯ÛŒÙ†Ú¯
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const loading = document.getElementById('loading');
    
    submitBtn.disabled = true;
    submitText.style.opacity = '0';
    loading.style.display = 'block';

    try {
      const res = await fetch(API_BASE + '/api/sales/register', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json', 
          'X-Seller-ID': 'frontend' 
        },
        body: JSON.stringify({ 
          store_name: storeName,
          imei, 
          phone_model: model, 
          city, 
          phone_number: phone, 
          sale_date: saleDate
        })
      });
      
      const data = await res.json();
      
      if (data.success) {
        showToast('ÙØ±ÙˆØ´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯! ğŸ‰', 'success');
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
        document.getElementById('storeNameInput').value = '';
        document.getElementById('imeiInput').value = '';
        document.getElementById('modelInput').value = '';
        document.getElementById('cityInput').value = '';
        document.getElementById('phoneInput').value = '';
        
        // ØªÙ†Ø¸ÛŒÙ… Ù…Ø¬Ø¯Ø¯ ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø´Ù…Ø³ÛŒ
        const today = new Date();
        const todayJalali = gregorianToJalali(today.getFullYear(), today.getMonth() + 1, today.getDate());
        selectedDate = todayJalali;
        currentJalaliYear = todayJalali.year;
        currentJalaliMonth = todayJalali.month;
        updateDateInput();
        
        // Ø­Ø°Ù Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ validation
        document.querySelectorAll('input[type="text"], .date-picker-input').forEach(input => {
          input.classList.remove('error', 'success');
        });
      } else {
        showToast(data.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª ÙØ±ÙˆØ´ âŒ', 'error');
      }
    } catch(e) {
      showToast('Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ' + e.message + ' ğŸŒ', 'error');
    } finally {
      // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù„ÙˆØ¯ÛŒÙ†Ú¯
      submitBtn.disabled = false;
      submitText.style.opacity = '1';
      loading.style.display = 'none';
    }
  }

  // âœ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±ÙˆØ´ Ø¨Ø§ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ Ùˆ Ø±Ø¯ÛŒÙ
  async function loadSalesData() {
    if (!isAdminLoggedIn) {
      showToast('Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø§Ø¯Ù…ÛŒÙ† ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯! ğŸ”', 'error');
      return;
    }
    
    try {
      const res = await fetch(API_BASE + '/api/sales/data', {
        headers: { 'Authorization': 'Bearer Honor2025Admin!' }
      });
      
      if(!res.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª');
      
      const result = await res.json();
      const tbody = document.getElementById('salesTbody');
      tbody.innerHTML = '';
      
      if(result.data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</td></tr>';
      } else {
        result.data.forEach((row, index) => {
          // âœ… ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ø¨Ù‡ Ø´Ù…Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
          let persianDate = '';
          if (row.sale_date || row.created_at) {
            const date = new Date(row.sale_date || row.created_at);
            const jalali = gregorianToJalali(date.getFullYear(), date.getMonth() + 1, date.getDate());
            persianDate = `${jalali.day} ${persianMonthNames[jalali.month - 1]} ${jalali.year}`;
          }
          
          tbody.innerHTML += `<tr>
            <td><strong>${index + 1}</strong></td>
            <td>${row.store_name || '-'}</td>
            <td style="font-family: monospace; font-size: 11px;">${row.imei}</td>
            <td>${row.phone_model}</td>
            <td>${row.city || '-'}</td>
            <td>${row.phone_number || '-'}</td>
            <td><strong style="color: #3995e7;">${persianDate}</strong></td>
          </tr>`;
        });
      }
      
      document.getElementById('dataTable').style.display = 'block';
      adminMenu.style.display = 'none';
      showToast(`${result.data.length} Ø±Ú©ÙˆØ±Ø¯ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯ ğŸ“Š`, 'success');
    } catch(e) {
      showToast('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: ' + e.message + ' âŒ', 'error');
    }
  }

  // Ø¯Ø§Ù†Ù„ÙˆØ¯ CSV
  async function downloadData() {
    if(!isAdminLoggedIn){
      showToast('Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø§Ø¯Ù…ÛŒÙ† ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯! ğŸ”', 'error');
      return;
    }
    
    try{
      const res = await fetch(API_BASE + '/api/sales/export', {
        headers: { 'Authorization': 'Bearer Honor2025Admin!' }
      });
      
      if(!res.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„');
      
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      const today = new Date();
      const todayJalali = gregorianToJalali(today.getFullYear(), today.getMonth() + 1, today.getDate());
      a.download = `honor_sales_${todayJalali.year}_${todayJalali.month}_${todayJalali.day}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      
      showToast('ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯ ğŸ“¥', 'success');
      adminMenu.style.display = 'none';
    } catch(e){
      showToast('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯: ' + e.message + ' âŒ', 'error');
    }
  }

  // Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ù…ÙˆØ¯Ø§Ù„ Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
  function showDeleteModal() {
    if(!isAdminLoggedIn){
      showToast('Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø§Ø¯Ù…ÛŒÙ† ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯! ğŸ”', 'error');
      return;
    }
    document.getElementById('deleteModal').style.display = 'flex';
    adminMenu.style.display = 'none';
  }
  
  function hideDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
  }

  // Ø­Ø°Ù Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
  async function deleteAllData() {
    try {
      const res = await fetch(API_BASE + '/api/admin/delete-all', {
        method: 'DELETE',
        headers: { 'Authorization': 'Bearer Honor2025Admin!' }
      });
      
      if(!res.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§');
      
      showToast('ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø­Ø°Ù Ø´Ø¯Ù†Ø¯ ğŸ—‘ï¸', 'success');
      hideDeleteModal();
      document.getElementById('dataTable').style.display = 'none';
    } catch(e) {
      showToast('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù: ' + e.message + ' âŒ', 'error');
    }
  }

  // Ø§ØªØµØ§Ù„ Enter key Ø¨Ù‡ ÙØ±Ù…
  document.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && e.target.tagName === 'INPUT') {
      submitSale();
    }
  });

  // ÙÙ‚Ø· Ø§Ø¹Ø¯Ø§Ø¯ Ø¯Ø± IMEI
  document.getElementById('imeiInput').addEventListener('input', (e) => {
    e.target.value = e.target.value.replace(/\D/g, '').slice(0, 15);
  });

  // ÙÙ‚Ø· Ø§Ø¹Ø¯Ø§Ø¯ Ø¯Ø± Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†
  document.getElementById('phoneInput').addEventListener('input', (e) => {
    e.target.value = e.target.value.replace(/\D/g, '').slice(0, 11);
  });

  // Escape key Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      hideDeleteModal();
      adminMenu.style.display = 'none';
      document.getElementById('datePickerCalendar').style.display = 'none';
      stopScanner();
    }
  });
</script>

</body>
</html>